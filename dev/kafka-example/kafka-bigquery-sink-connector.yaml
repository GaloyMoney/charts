apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: kafka-bigquery-sink-connector
  labels:
    strimzi.io/cluster: kafka
spec:
  class: com.wepay.kafka.connect.bigquery.BigQuerySinkConnector
  tasksMax: 1
  config:
    name: kafka-bigquery-sink-connector
    tasks.max: 1
    topics.regex: mongo.*
    project: galoy_dev_gcp_project
    defaultDataset: minikube_test
    schemaRetriever: com.wepay.kafka.connect.bigquery.retrieve.IdentitySchemaRetriever
    keyfile: ${secrets:kafka-dev/bigquery-cert:cert.json}
    keySource: JSON
    sanitizeTopics: true
    sanitizeFieldNames: true
    autoCreateTables: true
    allowNewBigQueryFields: true
    allowBigQueryRequiredFieldRelaxation: true
    allowSchemaUnionization: false
    upsertEnabled: true
    deleteEnabled: true
    bigQueryRetry: 5  
    bigQueryRetryWait: 15000
    config.action.reload: restart
    timestamp: UTC
    kafkaKeyFieldName: kafka_key
    kafkaDataFieldName: kafka_data
    key.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter.schemas.enable: true
    errors.tolerance: all
    errors.log.enable": true
    errors.log.include.messages": true
    errors.deadletterqueue.context.headers.enable: true
    errors.deadletterqueue.topic.name: dlq_bigquery_sink
    errors.deadletterqueue.topic.replication.factor: 1
