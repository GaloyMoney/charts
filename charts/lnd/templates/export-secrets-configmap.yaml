apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-export-secrets" (include "lnd.fullname" .) }}
  labels:
    {{- include "lnd.labels" . | nindent 4 }}
data:
  exportSecrets.sh: |
    #!/bin/sh
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/tls.cert ./secrets/tls.cert
    kubectl create configmap lndtls --from-file=./tls.cert --dry-run -o yaml | kubectl apply -f -
    mkdir macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/admin.macaroon ./macaroon/admin.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/readonly.macaroon ./macaroon/readonly.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/invoices.macaroon ./macaroon/invoices.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/chainnotifier.macaroon ./macaroon/chainnotifier.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/signer.macaroon ./macaroon/signer.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/walletkit.macaroon ./macaroon/walletkit.macaroon
    kubectl cp {{ include "lnd.fullname" . }}-0:/root/.lnd/data/chain/bitcoin/$NETWORK/router.macaroon ./macaroon/router.macaroon
    kubectl create configmap lndmacaroon --from-file=./macaroon --dry-run -o yaml | kubectl apply -f -
