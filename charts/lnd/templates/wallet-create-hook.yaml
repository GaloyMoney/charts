apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "lnd.fullname" . }}-wallet-create"
  annotations:
    "helm.sh/hook": "post-install"
spec:
  securityContext:
    runAsUser: 0
  serviceAccountName: {{ include "lnd.serviceAccountName" . }}
  containers:
  - name: create-wallet
    image: "boxboat/kubectl"
    imagePullPolicy: IfNotPresent
    command: ['/bin/sh']
    args: ['-c','apk update; apk add expect;{{ if ne .Values.global.network "regtest" }} ./walletInit.exp {{.Values.global.network}} $LND_PASS;{{ end }} ./exportSecrets.sh']
    env:
    - name: LND_PASS
      valueFrom:
        secretKeyRef:
          name: lnd-pass
          key: password
    - name: NETWORK
      valueFrom:
        secretKeyRef:
          name: network
          key: network
    volumeMounts:
    - name: wallet-init
      mountPath: /home/alpine/walletInit.exp
      subPath: walletInit.exp
    - name: export-secrets
      mountPath: /home/alpine/exportSecrets.sh
      subPath: exportSecrets.sh
  volumes:
  - name: wallet-init
    configMap:
      name: {{ printf "%s-wallet-init" (include "lnd.fullname" .) }}
      defaultMode: 0777
  - name: export-secrets
    configMap:
      name: {{ printf "%s-export-secrets" (include "lnd.fullname" .) }}
      defaultMode: 0777
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
