apiVersion: batch/v1
kind: Job
metadata:
  name: {{ .Release.Name }}-mongodb-migrate-{{ .Release.Revision }}
spec:
  backoffLimit: 1
  template:
    spec:
      containers:
      - name: mongodb-migrate
        image: "{{ $.Values.mongodbMigrateImage.repository }}@{{ $.Values.mongodbMigrateImage.digest }}"
        env:
        - name: MONGODB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ $.Release.Name }}-mongodb
              key: "mongodb-password"
        - name: MONGODB_USER
          value: "testGaloy"
        - name: MONGODB_ADDRESS
          value: {{ $.Values.mongodbaddress }}
      restartPolicy: never
