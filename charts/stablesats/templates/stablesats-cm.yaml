apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "stablesats.fullname" . }}
data:
  stablesats.yml: |-
    pubsub:
{{- if .Values.stablesats.externalRedis }}
{{- toYaml .Values.stablesats.externalRedis | nindent 6 }}
{{- else }}
      sentinel:
        hosts:
        - host: "{{ .Chart.Name }}-redis-node-0.{{ .Chart.Name }}-redis-headless"
        - host: "{{ .Chart.Name }}-redis-node-1.{{ .Chart.Name }}-redis-headless"
        - host: "{{ .Chart.Name }}-redis-node-2.{{ .Chart.Name }}-redis-headless"
{{- end }}

    exchanges:
      okex:
        weight: 1.0
        config:
          api_key: {{ .Values.stablesats.okex.apiKey }}
          simulated: {{ .Values.stablesats.okex.simulated }}
    price_server:
      enabled: true
      server:
        listen_port: {{ .Values.stablesats.priceServer.port }}
      fees:
        base_fee_rate: {{ .Values.stablesats.priceServer.fees.baseFeeRate }}
        immediate_fee_rate: {{ .Values.stablesats.priceServer.fees.immediateFeeRate }}
        delayed_fee_rate: {{ .Values.stablesats.priceServer.fees.delayedFeeRate }}
      price_cache:
        stale_after: {{ .Values.stablesats.priceServer.priceCache.staleAfter }}
      health:
        unhealthy_msg_interval_price: {{ .Values.stablesats.priceServer.health.unhealthyMsgIntervalPrice }}
    user_trades:
      enabled: {{ .Values.stablesats.userTrades.enabled }}
      config:
        migrate_on_start: true
        balance_publish_frequency: {{ .Values.stablesats.userTrades.balancePublishFrequency }}
        galoy_poll_frequency: {{ .Values.stablesats.userTrades.galoyPollFrequency }}
    hedging:
      enabled: {{ .Values.stablesats.hedging.enabled }}
      config:
        migrate_on_start: true
        okex_poll_frequency: {{ .Values.stablesats.hedging.okexPollFrequency }}
        health:
          unhealthy_msg_interval_position: {{ .Values.stablesats.hedging.health.unhealthyMsgIntervalPosition }}
          unhealthy_msg_interval_liability: {{ .Values.stablesats.hedging.health.unhealthyMsgIntervalLiability }}
          unhealthy_msg_interval_price: {{ .Values.stablesats.hedging.health.unhealthyMsgIntervalPrice }}
    galoy:
      api: {{ .Values.stablesats.galoy.api }}
      phone_number: {{ .Values.stablesats.galoy.phoneNumber }}
    tracing:
      service_name: {{ .Values.stablesats.tracing.serviceName }}
      host: {{ .Values.stablesats.tracing.jaegerHost }}
      port: 6831
